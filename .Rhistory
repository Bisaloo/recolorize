# use imposeColors
werner_fit <- imposeColors(img,
werner_centers, adjust.centers = FALSE,
plotting = FALSE)
# text labels?
idx <- order(werner_fit$sizes / sum(werner_fit$sizes),
decreasing = TRUE)[1:n_colors]
ctrs <- werner_fit$centers[idx, ]
layout(matrix(1:3, nrow = 1), widths = c(0.2, 0.4, 0.4))
plotColorPalette(ctrs, cex.text = 0,
horiz = FALSE)
plotImageArray(werner_fit$recolored.img)
plot(0:1, 0:1, ann = F, axes = F, type = "n")
text(0.5, seq(0.1, 0.9, length.out = n_colors),
labels = werner$name[werner_idx[idx]],
col = werner$hex[werner_idx[idx]],
cex = 2, font = 2)
werner_fit$werner.names <- werner$name[werner_idx]
return(werner_fit)
}
devtools::load_all(".")
rm(list = c("wernerColor"))
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6)
recolorize.obj <- corbetti_recluster
# first, convert werner colors to lab
werner_rgb <- t(col2rgb(werner$hex)) / 255
werner_lab <- grDevices::convertColor(werner_rgb,
"sRGB", "Lab")
# get centers
centers <- recolorize.obj$centers
centers <- grDevices::convertColor(centers,
"sRGB", "Lab")
# get distances
tmp <- sapply(1:nrow(centers),
function(i) apply(werner_lab, 1,
function(v) sqrt(sum((centers[i, ]-v)^2))))
# find index of min distance
werner_idx <- max.col(-t(tmp))
# get new colors
werner_centers <- werner_rgb[werner_idx, ]
werner_centers
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6)
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6)
labels <- gsub(" ", "\n", werner$name[werner_idx[idx]])
devtools::load_all(".")
labels <- gsub(" ", "\n", werner$name[werner_idx[idx]])
x<- wernerColor(corbetti_recluster, n_colors = 6)
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6)
x<- wernerColor(corbetti_recluster, n_colors = 6)
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6)
?text
devtools::load_all(".")
x<- wernerColor(corbetti_recluster, n_colors = 6, which.img = "recolored")
x<- wernerColor(corbetti_recluster,
n_colors = 6,
which.img = "original")
x<- wernerColor(recolored_corbetti,
n_colors = 6,
which.img = "original")
x<- wernerColor(recolored_corbetti,
n_colors = 5,
which.img = "original")
x<- wernerColor(recolored_corbetti,
n_colors = 10,
which.img = "original")
x<- wernerColor(recolored_corbetti,
n_colors = 6,
which.img = "original")
werner
#' @return
#' A recolorize object with an additional list element, `werner.names`,
#' listing the Werner color names for each center.
#'
#' @details
#' See \url{https://www.c82.net/werner/} to check out the original colors.
#'
#' @examples
#'
#' # get an initial fit:
corbetti <- system.file("extdata/corbetti.png", package = "recolorize")
recolored_corbetti <- recolorize(corbetti, plotting = FALSE)
corbetti_recluster <- recluster(recolored_corbetti,
similarity_cutoff = 45,
plot_hclust = FALSE)
corbetti_werner <- wernerColor(corbetti_recluster)
corbetti_werner <- wernerColor(corbetti_recluster, which.img = "recolored")
corbetti_werner <- wernerColor(recolored_corbetti, which.img = "recolored")
corbetti_werner <- wernerColor(recolored_corbetti, which.img = "original")
corbetti_werner <- wernerColor(recolored_corbetti, which.img = "original", n_colors = 6)
corbetti_recluster <- recluster(recolored_corbetti,
similarity_cutoff = 45,
plot_hclust = FALSE)
corbetti_werner <- wernerColor(corbetti_recluster, which.img = "recolored")
corbetti_werner <- wernerColor(corbetti_recluster, which.img = "original")
corbetti_werner <- wernerColor(corbetti_recluster, which.img = "recolored")
corbetti_werner <- wernerColor(recolored_corbetti,
which.img = "original",
n_colors = 6)
devtools::load_all(".")
devtools::load_all(".")
recolorize::werner
recolorize::werner$hex
x<- wernerColor(recolored_corbetti,
n_colors = 6,
which.img = "original")
library(recolorize)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 3)
# recluster: correct over-clustering ####
chongi <- system.file("extdata/chongi.png", package = "recolorize")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 3)
# we can group together the most similar clusters:
reclustered_chongi <- recluster(recolored_chongi,
similarity_cutoff = 60,
plot_hclust = TRUE)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2)
# we can group together the most similar clusters:
reclustered_chongi <- recluster(recolored_chongi,
similarity_cutoff = 60,
plot_hclust = TRUE)
# we can also specify our final number of colors, as with kmeans:
recluster_chongi <- recluster(recolored_chongi,
n_final = 6,
plot_hclust = TRUE)
# compare with actual kmeans with n = 6; the navy is usually split into 2-3
# colors, and we get different results every time (!):
kmeans_chongi <- recolorize(chongi, "k", n = 6)
kmeans_chongi <- recolorize(chongi, "k", n = 6)
kmeans_chongi <- recolorize(chongi, "k", n = 6)
# you can also recluster a kmeans fit, which is nice
# the cutoff typically has to be lower and you do still have the issue of
# different results every time, but the recluster fit tends to be stable
kmeans_chongi <- recolorize(chongi, "k", n = 20)
kmeans_recluster <- recluster(kmeans_chongi, similarity_cutoff = 45)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2)
x<- wernerColor(recolored_chongi,
n_colors = 6,
which.img = "original")
library(recolorize)
devtools::load_all(".")
x<- wernerColor(recolored_chongi,
n_colors = 6,
which.img = "original")
x<- wernerColor(recolored_chongi,
n_colors = 6,
which_img = "original")
# you can use different color palettes:
pal <- viridisLite::viridis(100)
# This one was Able's suggestion: can we look at one color cluster at a time?
# get original fit
corbetti <- system.file("extdata/corbetti.png", package = "recolorize")
recolored_corbetti <- recolorize::recolorize(corbetti, plotting = TRUE)
# make a layout
layout(matrix(c(1, 1:9), nrow = 2))
# plot original
plotImageArray(recolored_corbetti$original.img)
# plot layers
corbetti_layers <- splitByColor(recolored_corbetti,
plot_method = "overlay")
# so, you could plot the layers as binary masks...
plotImageArray(recolored_corbetti$original.img)
corbetti_layers <- splitByColor(recolored_corbetti,
plot_method = "binary")
# or split the different and color the binary masks:
plotImageArray(recolored_corbetti$original.img)
corbetti_layers <- splitByColor(recolored_corbetti,
plot_method = "colormask")
# well hey, luckily we can fix that now:
corbetti_recluster <- recluster(recolored_corbetti,
similarity_cutoff = 45,
plot_hclust = T)
# and now we can look at the layers again:
layout(matrix(1:6, nrow = 2))
plotImageArray(corbetti_recluster$original.img)
corbetti_layers <- splitByColor(corbetti_recluster, plot_method = "overlay")
# we can examine the binary masks stored within the layers list:
layout(matrix(1:2, nrow = 1))
plotImageArray(corbetti_layers[[2]], main = "original layer")
# make an imager pixset so we can clean up stray pixels:
px <- imager::as.cimg(corbetti_layers[[2]] == 1)
px_clean <- imager::clean(px, 3)
# convert back to an image for plotting
plotImageArray(recolorize:::cimg.to.array(px_clean), main = "cleaned layer")
x<- wernerColor(recolored_corbetti,
n_colors = 6,
which_img = "original")
x<- wernerColor(rclustered_corbetti,
n_colors = 6,
which_img = "original")
x<- wernerColor(reclustered_corbetti,
n_colors = 6,
which_img = "original")
x<- wernerColor(corbetti_recluster,
n_colors = 6,
which_img = "original")
?imHeatmap
chongi <- system.file("extdata/chongi.png", package = "recolorize")
chongi_k <- recolorize(chongi, "k", n = 5)
d <- imDist(chongi_k$original.img,
chongi_k$recolored.img, plotting = FALSE)
# original flavor
imHeatmap(d)
devtools::load_all(".")
chongi <- system.file("extdata/chongi.png", package = "recolorize")
chongi_k <- recolorize(chongi, "k", n = 5)
d <- imDist(chongi_k$original.img,
chongi_k$recolored.img, plotting = FALSE)
# original flavor
imHeatmap(d)
chongi <- system.file("extdata/chongi.png", package = "recolorize")
chongi_k <- recolorize(chongi, "k", n = 5)
d <- imDist(chongi_k$original.img,
chongi_k$recolored.img, plotting = FALSE)
# original flavor
imHeatmap(d, main = "test")
#'
#' # assign pixels
#' reassigned <- recolorize::assignPixels(ctrs, pixel.matrix, adjust.centers = TRUE)
#' recolorize::plotColorPalette(reassigned$centers)
#'
#' # if we turn off adjust.centers, the colors remain the same as the inputs:
#' keep.centers <- recolorize::assignPixels(ctrs, pixel.matrix, adjust.centers = FALSE)
#' recolorize::plotColorPalette(keep.centers$centers)
#'
#' @export
assignPixels <- function(color.centers,
pixel.matrix,
color.space = "Lab",
ref.white = "D65",
adjust.centers = TRUE) {
if (color.space != "sRGB") {
pm <- grDevices::convertColor(pixel.matrix,
from = "sRGB",
to = color.space,
to.ref.white = ref.white)
ctr <- grDevices::convertColor(color.centers,
from = "sRGB",
to = color.space,
to.ref.white = ref.white)
}
# I'm not sure this is really as fast as it could be
tmp <- sapply(1:nrow(pm),
function(i) apply(ctr, 1,
function(v) sum((pm[i, ]-v)^2)))
# make returnables
pixel.assignments <- max.col(-t(tmp))  # find index of min distance
assignments <- table(pixel.assignments) # make a table of assigned pixels
sizes <- rep(0, nrow(color.centers))
sizes[as.numeric(names(assignments))] <- assignments # empty clusters are 0
# if specified: make new color centers based on average of assigned pixels
if (adjust.centers) {
for (i in 1:nrow(ctrs)) {
pixel.idx <- which(pixel.assignments == i)
if (length(pixel.idx) == 0) { next } else {
ctrs[i, ] <- colMeans(pm[pixel.idx, ])
}
}
}
# and convert back to sRGB
if (color.space != "sRGB") {
color.centers <- grDevices::convertColor(ctrs,
from = color.space,
to = "sRGB",
from.ref.white = ref.white)
}
color.clusters <- list(pixel.assignments = pixel.assignments,
centers = color.centers,
sizes = sizes)
class(color.clusters) <- "color.clusters"
return(color.clusters)
}
convertColor(rbind(c(0, 0, 1),))
convertColor(rbind(c(0, 0, 1),
c(1, 1, 0)), "sRGB", "Lab")
convertColor(rbind(c(0, 0, 1), c(1, 1, 0)), "sRGB", "sRGB")
convertColor(rbind(c(0, 0, 1), c(1, 1, 0), c(1, 0, 1)), "sRGB", "sRGB")
convertColor(rbind(c(0, 0, 1), c(1, 1, 0), c(1, 0, 1)), "sRGB", "Lab")
x <- convertColor(rbind(c(0, 0, 1), c(1, 1, 0), c(1, 0, 1)), "sRGB", "Lab")
convertColor(x, "Lab", "sRGB")
convertColor(x, "Lab", "XYZ")
convertColor(x, "Lab", "Luv")
color.space <- "XYZ"
color.space == "sRGB"|"XYZ"
grepl("sRGB|XYZ", color.space)
color.space <- "XYZ"
match.arg(color.space c("a", "XYZ"))
match.arg(color.space, c("a", "XYZ"))
bins = 2
# format bins
if (length(bins) == 1) {
message(paste("\nUsing ", bins, "^3 = ", paste(bins^3),
" total bins", sep = ""))
bins <- rep(bins, 3)
} else {
message(paste("\nUsing ", bins[1], "*", bins[2],
"*", bins[3], " = ", bins[1] * bins[2] * bins[3],
" bins", sep = ""))
}
bins
# color space ranges
if (grepl("sRGB|XYZ", color.space)) {
#sRGB and XYZ range is 0-1 in all channels
brange <- list(c(0, 1),
c(0, 1),
c(0, 1))
} else if (grepl("Luv|Lab", color.space)) {
# Lab is 0-100 (L), -127-127 (a and b)
# Luv is greater (?) than that (?) but this works
brange <- list(c(0, 100),
c(-127, 127),
c(-127, 127))
}
brange
color.space = "Lab"
# color space ranges
if (grepl("sRGB|XYZ", color.space)) {
#sRGB and XYZ range is 0-1 in all channels
brange <- list(c(0, 1),
c(0, 1),
c(0, 1))
} else if (grepl("Luv|Lab", color.space)) {
# Lab is 0-100 (L), -127-127 (a and b)
# Luv is greater (?) than that (?) but this works
brange <- list(c(0, 100),
c(-127, 127),
c(-127, 127))
}
brange
bins + 1
# from bins, generate breaks/ranges
breaks <- lapply(bins + 1, function(x) seq(0, 1, length = x))
breaks
bins
brange[i][1]
brange[1][1]
brange[[1]][1]
bins
brange
# from bins, generate breaks/ranges
breaks <- lapply(1:3, function(x) seq(brange[[x]][1],
brange[[x]][2],
length = bins[x] + 1))
breaks
pixel.matrix
strsplit(color.space, "")
strsplit(gsub("s", "", color.space), "")
strsplit(gsub("s", "", color.space), "")[[1]]
?recolorize
img <- system.file("extdata/chongi.png", package = "recolorize")
recolorize(img)
devtools::load_all(".")
recolorize(img)
test <- recolorize(img)
test$centers
test <- recolorize(img, bins = 3)
test <- recolorize(img, method = "k")
test <- recolorize(img, method = "k", n = 5)
test <- recolorize(img, method = "k", n = 25)
test <- recolorize(img, method = "k", n = 20)
test <- recolorize(img, method = "k", n = 10)
devtools::load_all(".")
test <- recolorize(img, method = "k", n = 10)
test <- recolorize(img, method = "k", n = 10, color.space = "sRGB")
test <- recolorize(img, color.space = "sRGB")
test <- recolorize(img, color.space = "sRGB", bins = 3)
test <- recolorize(img, color.space = "Lab", bins = 3)
rgbrand <- runif(3000)
r <- matrix(rgbrand, ncol = 3)
dim(r)
apply(convertColor(r, "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(rgbrand, ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(3000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(3000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Lab"), 2, range)
devtools::load_all(".")
test <- recolorize(img, color.space = "Lab", bins = 3)
test <- recolorize(img, color.space = "Lab", bins = 3)
test <- recolorize(img, color.space = "Lab", bins = c(3, 5, 3))
test <- recolorize(img, color.space = "Lab", bins = 5
)
test <- recolorize(img, color.space = "Lab", bins = 6)
beetles <- dir(system.file("int/extdata", "recolorize"))
beetles
beetles <- dir(system.file("inst/extdata", "recolorize"))
beetles
beetles <- dir(system.file("extdata", "recolorize"))
beetles
beetles <- dir(system.file("extdata*", "recolorize"))
beetles
beetles <- dir(system.file("extdata/", "recolorize"))
beetles
system.file("extdata/", "recolorize")
system.file("extdata/chongi", "recolorize")
system.file("extdata/chongi.png", "recolorize")
system.file("extdata/chongi.png", package = "recolorize")
system.file("extdata/", package = "recolorize")
dir(system.file("extdata/", package = "recolorize"))
dir(system.file("extdata/", package = "recolorize"), "png", full.names = TRUE)
beetles <- dir(system.file("extdata/", package = "recolorize"), "png", full.names = TRUE)
test <- recolorize(beetles[2], color.space = "Lab", bins = 5)
test <- recolorize(beetles[2], color.space = "Lab", bins = 2)
test <- recolorize(beetles[2], color.space = "Lab", bins = 3)
test <- recolorize(beetles[2], color.space = "sRGB", bins = 3)
?cut
test <- recolorize(beetles[2], color.space = "sRGB", bins = 2)
test <- recolorize(beetles[2], color.space = "XYZ", bins = 2)
apply(convertColor(matrix(runif(3000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(3000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "XYZ"), 2, range)
devtools::load_all(".")
test <- recolorize(beetles[2], color.space = "sRGB", bins = 3)
test <- recolorize(beetles[2], color.space = "xyz", bins = 2)
test <- recolorize(beetles[2], color.space = "XYZ", bins = 2)
devtools::load_all(".")
test <- recolorize(beetles[2], color.space = "Luv", bins = 2)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(30000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Luv"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Luv"), 2, range)
devtools::load_all(".")
test <- recolorize(beetles[2], color.space = "Luv", bins = 2)
test <- recolorize(beetles[2], color.space = "Luv", bins = 3)
test <- recolorize(beetles[2], color.space = "Lab", bins = 3)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Lab"), 2, range)
apply(convertColor(matrix(runif(300000), ncol = 3), "sRGB", "Lab"), 2, range)
devtools::load_all(".")
test <- recolorize(beetles[2], color.space = "Lab", bins = 3)
test <- recolorize(beetles[2], color.space = "Lab", bins = 2)
test <- recolorize(beetles[2], color.space = "Lab", bins = 3)
devtools::load_all(".")
test <- recolorize(beetles[2], bins = 3)
test <- recolorize(beetles[2], bins = 2)
test <- recolorize(beetles[3], bins = 2)
test <- recolorize(beetles[3], bins = 2, color.space = "Lab")
test <- recolorize(beetles[3], bins = 3, color.space = "Lab")
test <- recolorize(beetles[3], bins = 3, color.space = "sRGB")
# install and load the updated package:
devtools::install_github("hiweller/recolorize")
devtools::load_all(".")
library(recolorize)
# these are the new functions of interest:
?recluster
?imDist
?splitByColor
# recluster: correct over-clustering ####
chongi <- system.file("extdata/chongi.png", package = "recolorize")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2, color.space = "Luv")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2, color.space = "sRGB")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 3, color.space = "sRGB")
recolored_chongi <- recolorize(chongi, "k", n = 5, color.space = "sRGB")
recluster(recolored_chongi, similarity_cutoff = 45, plot_hclust = TRUE)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 3, color.space = "sRGB")
recluster(recolored_chongi, similarity_cutoff = 45, plot_hclust = TRUE)
x <- recluster(recolored_chongi, similarity_cutoff = 60, plot_hclust = TRUE)
?logLik
pm
?colorClusters
?colorCluster
devtools::load_all(".")
devtools::load_all(".")
?colorCluster
?colorClusters
img <- array(runif(30000), dim = c(100, 100, 3))
dim(img)
img.2d <- img
dim(img.2d) <- c(100 * 100, 3)
head(img.2d)
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 3, color.space = "sRGB")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_chongi <- recolorize(chongi, bins = 2, color.space = "sRGB")
ocellata <- system.file("extdata/ocellata.png", package = "recolorize")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_o <- recolorize(ocellata, bins = 2, color.space = "sRGB")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_o <- recolorize(ocellata, bins = 3, color.space = "sRGB")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_o <- recolorize(ocellata, bins = 4, color.space = "sRGB")
# using 3 bins/channel splits uniform regions (e.g. the navy):
recolored_o <- recolorize(ocellata, bins = 2, color.space = "sRGB")
x <- splitByColor(recolored_o)
